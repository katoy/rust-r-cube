# 2x2 ルービックキューブ

Rustで実装した2x2ルービックキューブのGUIプログラムです。超高速な双方向BFSソルバー機能を搭載しています。

## 特徴

- 🎮 **インタラクティブなGUI**: モダンで使い勝手の良いインターフェース
- 🚀 **超高速最短解ソルバー**: 双方向BFSと最適化されたデータ構造により、最短解を瞬時に探索
- 📊 **リアルタイム進捗表示**: 解法探索中の進捗をプログレスバーで可視化
- 🎯 **解決モードの切り替え**: 「色のみを揃える」か「矢印の向きまで完璧に揃える」かを自由に選択可能
- ✨ **スムーズなアニメーション**: イージング関数を使用した滑らかな回転移動
- 🔄 **向きの可視化**: 各ステッカーに矢印マークを表示し、ステッカー自体の向きを視覚化
- ⚙️ **アニメーション制御**: 速度調整、再生/一時停止、ステップごとの操作

## 必要要件

- Rust 1.70以上

## ビルドと実行

```bash
# リリースビルド
cargo build --release

# 実行
cargo run --release
```

## 使い方

### 基本操作

- **スクランブル**: キューブをランダムに5〜10手混ぜます
- **リセット**: キューブを初期状態（完成状態）に戻します
- **解決設定**:
  - **向き無視**: 各面の色さえ揃えば完成とみなします (最大深度: 11)
  - **向きも揃える**: 色に加えて、ステッカーの矢印まで全て初期状態に揃えます (最大深度: 14)
- **解法を探す**: 現在の状態から最短解を探索します（進捗バーで進行状況を確認できます）

### 回転操作

- 各ボタン（R, L, U, D, F, B およびその逆回転）をクリックして直接操作できます。

### 解法ステップ操作

解法が見つかると、一歩ずつ進めたり戻したりできるコントローラーが表示されます。

## プロジェクト構造

```text
src/
├── main.rs           # エントリーポイント
├── lib.rs            # ライブラリルート
├── cube.rs           # キューブの状態管理と回転論理
├── solver.rs         # 最適化された双方向BFSソルバー
└── gui/
    ├── mod.rs        # GUIモジュール
    ├── app.rs        # アプリケーション状態・ライフサイクル管理
    ├── renderer_3d.rs # 3D描画エンジン
    └── controls.rs   # 操作パネルUI
```

## 技術詳細

### 最適化されたソルバー

#### アルゴリズム
- **双方向BFS**: 開始状態と目標状態（24通りの完成状態）の両方から同時に探索することで、探索空間を劇的に削減。
- **時間計算量**: O(b^(d/2)) - 単方向BFSのO(b^d)と比較して大幅に高速

#### パフォーマンス最適化
- **FxHash**: `rustc-hash` (FxHashMap) を採用し、ハッシュマップの操作を高速化
- **容量事前確保**: HashMapとVecDequeの容量を事前に確保し、再ハッシュのコストを削減
- **Entry API**: `contains_key` + `insert` の代わりに `entry` APIを使用し、効率的なHashMapアクセスを実現
- **clone削減**: 不要なCubeのclone操作を削減し、メモリアロケーションを最小化
- **進捗送信最適化**: 進捗情報の送信頻度を調整し、チャネル送信のオーバーヘッドを削減

#### メモリ最適化
- **親への参照のみ保持**: 各探索ノードで操作履歴を保持せず、「親への参照」のみを保持
- **完成状態のキャッシュ**: `OnceLock` を使用し、全24通りの解決済み状態を一度だけ計算して再利用

### カバレッジと品質

- **テスト網羅率**: `solver.rs` および `cube.rs` のコアロジックにおいて、非常に高いコードカバレッジを達成しています。

| File             |  Regions  | Functions |   Lines   |
| :--------------- | :-------: | :-------: | :-------: |
| `src/cube.rs`    |  100.00%  |  100.00%  |  100.00%  |
| `src/solver.rs`  |  90.41%   |  87.50%   |  87.75%   |
| **Total (Core)** | **95.2%** | **93.8%** | **93.9%** |

- **検証済み**: 多様なスクランブルパターンおよび全体回転状態での正当性をテストで確認。

## ライセンス

MIT License

## 開発・検証

```bash
# 開発ビルド
cargo build

# テスト (高速化の成果を確認できます)
cargo test

# カバレッジ計測
cargo llvm-cov --summary-only

# クリーンアップ
cargo clippy && cargo fmt
```
